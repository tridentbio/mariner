name: GNNExample
dataset:
  name: Small Zinc dataset
  targetColumns:
    - name: tpsa
      dataType:
        domainKind: numeric
  featureColumns:
    - name: smiles
      dataType:
        domainKind: smiles
    - name: mwt
      dataType:
        domainKind: numeric

featurizers:
  - name: MolToGraphFeaturizer
    type: model_builder.featurizers.MoleculeFeaturizer
    forwardArgs:
      mol: $smiles
    constructorArgs:
      allow_unknown: false
      sym_bond_list: true
      per_atom_fragmentation: false

layers:
  # Start fst branch (from featurizer)
  - name: GCN1
    type: torch_geometric.nn.GCNConv
    constructorArgs:
      in_channels: 26
      out_channels: 64
    forwardArgs:
      x: ${MolToGraphFeaturizer.x}
      edge_index: ${MolToGraphFeaturizer.edge_index}
      edge_weight: ${MolToGraphFeaturizer.edge_attr}

  - name: GCN1_Activation
    type: torch.nn.ReLU
    constructorArgs:
      inplace: False
    forwardArgs:
      input: ${GCN1}

  - name: GCN2
    type: torch_geometric.nn.GCNConv
    forwardArgs:
      x: ${GCN1_Activation}
      edge_index: ${MolToGraphFeaturizer.edge_index}
      edge_weight: ${MolToGraphFeaturizer.edge_attr}
    constructorArgs:
      in_channels: 64
      out_channels: 64

  - name: GCN2_Activation
    type: torch.nn.ReLU
    constructorArgs:
      inplace: False
    forwardArgs:
      input: ${GCN2}

  - name: GCN3
    type: torch_geometric.nn.GCNConv
    forwardArgs:
      x: ${GCN2_Activation}
      edge_index: ${MolToGraphFeaturizer.edge_index}
      edge_weight: ${MolToGraphFeaturizer.edge_attr}
    constructorArgs:
      in_channels: 64
      out_channels: 64

  - name: GCN3_Activation
    type: torch.nn.ReLU
    constructorArgs:
      inplace: False
    forwardArgs:
      input: ${GCN3}

  - name: AddPool
    type: model_builder.layers.GlobalPooling
    forwardArgs:
      x: ${GCN3_Activation}
      edge_index: ${MolToGraphFeaturizer.edge_index}
      batch: ${MolToGraphFeaturizer.batch}
    constructorArgs:
      aggr: 'sum'
  # End of fst branch

  # Second branch would simply be linear layers in mwt
  - name: 'Linear1'
    type: torch.nn.Linear
    constructorArgs:
      in_features: 1
      out_features: 10
    forwardArgs:
      input: ${mwt}

  - name: Combiner
    type: model_builder.layers.Concat
    constructorArgs:
      dim: -1
    forwardArgs:
      xs:
        - '${AddPool}'
        - '${Linear1}'

  - name: LinearJoined
    type: torch.nn.Linear
    forwardArgs:
      input: $Combiner
    constructorArgs:
      in_features: 74
      out_features: 1
