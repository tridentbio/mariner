name: GNNExample
dataset:
  name: Small Zinc dataset
  target_column: 
    name: tpsa
    dataType:
      domain_kind: smiles
  featureColumns:
    - name: smiles
      dataType:
        domain_kind: smiles
    - name: mwt
      dataType:
        domain_kind: numeric

featurizers:
  - name: MolToGraphFeaturizer
    type: model_builder.featurizers.FromSmiles
    forward_args:
      x: $smiles
    constructor_args:
      kekulize: false
      with_hydrogen: true

layers:
  # Start fst branch (from featurizer)
  - name: GCN1
    type: torch_geometric.nn.GCNConv
    constructor_args:
      in_channels: 9
      out_channels: 64
    forward_args:
      x: ${MolToGraphFeaturizer.x}
      edge_index: ${MolToGraphFeaturizer.edge_index}
      edge_weight: ${MolToGraphFeaturizer.edge_attr}

  - name: GCN1_Activation
    type: torch.nn.ReLU
    constructor_args:
      inplace: False
    forward_args: 
      input: ${GCN1}

  - name: GCN2 
    type: torch_geometric.nn.GCNConv
    forward_args: 
      x: ${GCN1_Activation}
      edge_index: ${MolToGraphFeaturizer.edge_index}
      edge_weight: ${MolToGraphFeaturizer.edge_attr}
    constructor_args:
      in_channels: 64
      out_channels: 64

  - name: GCN2_Activation
    type: torch.nn.ReLU
    constructor_args:
      inplace: False
    forward_args:
      input: ${GCN2}

  - name: GCN3
    type: torch_geometric.nn.GCNConv
    forward_args:
      x: ${GCN2_Activation}
      edge_index: ${MolToGraphFeaturizer.edge_index}
      edge_weight: ${MolToGraphFeaturizer.edge_attr}
    constructor_args:
      in_channels: 64
      out_channels: 64

  - name: GCN3_Activation
    type: torch.nn.ReLU
    constructor_args:
      inplace: False
    forward_args:
      input: ${GCN3}

  - name: AddPool
    type: model_builder.layers.GlobalPooling
    forward_args:
      x: ${GCN3_Activation}
      edge_index: ${MolToGraphFeaturizer.edge_index}
      batch: ${MolToGraphFeaturizer.batch}
    constructor_args:
      aggr: 'sum'
  # End of fst branch

  # Second branch would simply be linear layers in mwt
  - name: "Linear1"
    type: torch.nn.Linear
    constructor_args:
      in_features: 1
      out_features: 10
    forward_args:
      input: ${mwt}

  - name: Combiner
    type: model_builder.layers.Concat
    constructor_args:
      dim: -1
    forward_args: 
      xs:
        - "${AddPool}"
        - "${Linear1}"

  - name: LinearJoined
    type: torch.nn.Linear
    forward_args:
      input: $Combiner
    constructor_args:
      in_features: 74
      out_features: 1
